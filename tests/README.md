# æµ‹è¯•å•å…ƒè¦†ç›–ç‡æŠ¥å‘Š

## ğŸ“Š æµ‹è¯•å®Œæˆæ¦‚å†µ

æœ¬æ¬¡ä¸ºé”æ·ç½‘ç»œè®¾å¤‡ä¿ä¿®æœŸæ‰¹é‡æŸ¥è¯¢å·¥å…·é¡¹ç›®è¡¥å…¨äº†å®Œæ•´çš„æµ‹è¯•å•å…ƒè¦†ç›–ç‡ï¼Œæ€»è®¡åˆ›å»ºäº† **139ä¸ªæµ‹è¯•ç”¨ä¾‹**ï¼Œè¦†ç›–é¡¹ç›®çš„6ä¸ªæ ¸å¿ƒæ¨¡å—ã€‚

## ğŸ¯ å·²å®Œæˆçš„æµ‹è¯•æ¨¡å—

### 1. é…ç½®ç®¡ç†æ¨¡å— (`tests/unit/test_config_manager.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š33ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- ConfigValidatorç±»çš„å®Œæ•´æµ‹è¯•
  - åˆå§‹åŒ–å’Œå‚æ•°éªŒè¯
  - Generalé…ç½®éªŒè¯ï¼ˆExcelè·¯å¾„ã€å»¶è¿Ÿè®¾ç½®ç­‰ï¼‰
  - CaptchaSettingsé…ç½®éªŒè¯ï¼ˆéªŒè¯ç è§£æå™¨è®¾ç½®ï¼‰
  - AIé…ç½®éªŒè¯ï¼ˆé‡è¯•æ¬¡æ•°ã€å»¶è¿Ÿè®¾ç½®ï¼‰
  - ResultColumnsé…ç½®éªŒè¯
  - Loggingé…ç½®éªŒè¯
  - é”™è¯¯å¤„ç†å’Œè­¦å‘Šæœºåˆ¶

- ConfigManagerç±»çš„å®Œæ•´æµ‹è¯•
  - é…ç½®æ–‡ä»¶åŠ è½½å’Œç®¡ç†
  - ä¸åŒé…ç½®è·å–æ–¹æ³•ï¼ˆGeneralã€Captchaã€AIã€Loggingç­‰ï¼‰
  - é…ç½®ä¿®å¤å’Œé»˜è®¤å€¼å¤„ç†
  - é…ç½®æ–‡ä»¶åˆ›å»ºå’Œä¿å­˜

**æµ‹è¯•åœºæ™¯ï¼š**
- æœ‰æ•ˆé…ç½®åŠ è½½æµ‹è¯•
- æ— æ•ˆé…ç½®ä¿®å¤æµ‹è¯•
- é…ç½®æ–‡ä»¶ä¸å­˜åœ¨å¤„ç†æµ‹è¯•
- æƒé™é”™è¯¯å¤„ç†æµ‹è¯•
- è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µæµ‹è¯•

### 2. æ•°æ®ç®¡ç†æ¨¡å— (`tests/unit/test_data_manager.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š24ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- DataManagerç±»çš„å®Œæ•´æµ‹è¯•
  - æ•°æ®åŠ è½½ï¼ˆExcelæ–‡ä»¶è¯»å–ï¼‰
  - æ•°æ®ä¿å­˜å’ŒæŒä¹…åŒ–
  - æŸ¥è¯¢ç»“æœæ›´æ–°æœºåˆ¶
  - æœªæŸ¥è¯¢åºåˆ—å·è·å–
  - æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†

**æµ‹è¯•åœºæ™¯ï¼š**
- æˆåŠŸçš„æ•°æ®åŠ è½½å’Œä¿å­˜
- ç¼ºå¤±åˆ—çš„è‡ªåŠ¨åˆ›å»º
- æ–‡ä»¶ä¸å­˜åœ¨å’Œæƒé™é”™è¯¯å¤„ç†
- éƒ¨åˆ†æ•°æ®æ›´æ–°æµ‹è¯•
- ç©ºæ•°æ®å’Œè¾¹ç•Œæƒ…å†µæµ‹è¯•
- æ–­ç‚¹ç»­ä¼ åŠŸèƒ½æµ‹è¯•

### 3. éªŒè¯ç è¯†åˆ«æ¨¡å— (`tests/unit/test_captcha_solver.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š18ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- CaptchaSolverç±»çš„å®Œæ•´æµ‹è¯•
  - ddddocrè¯†åˆ«å™¨åˆå§‹åŒ–å’Œé…ç½®
  - AIæ¸ é“è¯†åˆ«å’Œå¤‡ç”¨æ–¹æ¡ˆ
  - éªŒè¯ç è¯†åˆ«æµç¨‹æµ‹è¯•
  - é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
  - æ¸ é“å¯ç”¨æ€§æµ‹è¯•

**æµ‹è¯•åœºæ™¯ï¼š**
- ddddocræˆåŠŸå’Œå¤±è´¥åœºæ™¯
- AIæ¸ é“é…ç½®éªŒè¯
- æ— å¯ç”¨è¯†åˆ«å™¨å¤„ç†
- å¤šæ¬¡é‡è¯•é€»è¾‘æµ‹è¯•
- å›¾åƒå¤„ç†å’Œæ•°æ®æ ¼å¼æµ‹è¯•

### 4. WebDriverç®¡ç†æ¨¡å— (`tests/unit/test_webdriver_manager.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š21ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- WebDriverManagerç±»çš„å®Œæ•´æµ‹è¯•
  - WebDriveråˆå§‹åŒ–å’Œç®¡ç†
  - å¢å¼ºChromeDriverç®¡ç†å™¨åŠŸèƒ½
  - é©±åŠ¨è‡ªåŠ¨ä¸‹è½½å’Œç‰ˆæœ¬åŒ¹é…
  - å¹³å°ç‰¹å®šè·¯å¾„å¤„ç†
  - ç¼“å­˜ç®¡ç†å’Œæ¸…ç†

- EnhancedChromeDriverManagerç±»çš„æµ‹è¯•
  - Chromeç‰ˆæœ¬æ£€æµ‹
  - å…¼å®¹ç‰ˆæœ¬åŒ¹é…
  - ä¸‹è½½ç»Ÿè®¡å’Œæ€§èƒ½ç›‘æ§

**æµ‹è¯•åœºæ™¯ï¼š**
- æˆåŠŸå’Œå¤±è´¥çš„é©±åŠ¨åˆå§‹åŒ–
- é…ç½®æŒ‡å®šè·¯å¾„ä½¿ç”¨
- è‡ªåŠ¨ä¸‹è½½æœºåˆ¶æµ‹è¯•
- ç¦»çº¿å¤‡ç”¨æ–¹æ¡ˆæµ‹è¯•
- å¹³å°å…¼å®¹æ€§æµ‹è¯•

### 5. åº”ç”¨ç¨‹åºä¸»é€»è¾‘ (`tests/unit/test_app.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š16ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- RuijieQueryAppç±»çš„å®Œæ•´æµ‹è¯•
  - åº”ç”¨ç¨‹åºåˆå§‹åŒ–å’Œé…ç½®
  - å®Œæ•´è¿è¡Œæµç¨‹æµ‹è¯•
  - æ‰¹é‡æŸ¥è¯¢å¤„ç†é€»è¾‘
  - é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶
  - é‡è¯•å’Œæ–­ç‚¹ç»­ä¼ åŠŸèƒ½

**æµ‹è¯•åœºæ™¯ï¼š**
- å®Œæ•´å·¥ä½œæµç¨‹é›†æˆæµ‹è¯•
- æ•°æ®åŠ è½½å¤±è´¥å¤„ç†
- WebDriveråˆå§‹åŒ–å¤±è´¥å¤„ç†
- æ²¡æœ‰éªŒè¯ç è§£æå™¨å¤„ç†
- é‡è¯•æœºåˆ¶æµ‹è¯•
- ä¿å­˜é—´éš”åŠŸèƒ½æµ‹è¯•

### 6. æ€§èƒ½ç›‘æ§æ¨¡å— (`tests/unit/test_performance_monitor.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š15ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- PerformanceMonitorç±»çš„å®Œæ•´æµ‹è¯•
  - æ“ä½œè®¡æ—¶å’Œç»Ÿè®¡
  - æ…¢æ“ä½œæ£€æµ‹å’Œè®°å½•
  - æ€§èƒ½æŠ¥å‘Šç”Ÿæˆ
  - è£…é¥°å™¨åŠŸèƒ½æµ‹è¯•

**æµ‹è¯•åœºæ™¯ï¼š**
- è®¡æ—¶å™¨å¯åŠ¨å’Œåœæ­¢
- å¤šæ¬¡æ“ä½œç»Ÿè®¡èšåˆ
- æ…¢æ“ä½œé˜ˆå€¼æ£€æµ‹
- å¼‚å¸¸å¤„ç†å’Œæ¢å¤
- åµŒå¥—ç›‘æ§æµ‹è¯•

### 7. é›†æˆæµ‹è¯• (`tests/integration/test_full_workflow.py`)
**æµ‹è¯•ç”¨ä¾‹æ•°ï¼š12ä¸ª**

**è¦†ç›–çš„ä¸»è¦åŠŸèƒ½ï¼š**
- å®Œæ•´å·¥ä½œæµç¨‹é›†æˆæµ‹è¯•
  - ç»„ä»¶é—´åä½œéªŒè¯
  - ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
  - é”™è¯¯å¤„ç†é›†æˆæµ‹è¯•
  - æ€§èƒ½å’Œç¨³å®šæ€§æµ‹è¯•

**æµ‹è¯•åœºæ™¯ï¼š**
- å®Œæ•´æŸ¥è¯¢å·¥ä½œæµç¨‹
- æ–­ç‚¹ç»­ä¼ é›†æˆæµ‹è¯•
- ä¿å­˜é—´éš”é›†æˆæµ‹è¯•
- é”™è¯¯æ¢å¤é›†æˆæµ‹è¯•
- æ€§èƒ½ç›‘æ§é›†æˆæµ‹è¯•

## ğŸ“ˆ æµ‹è¯•ç»Ÿè®¡

```
æ€»æµ‹è¯•ç”¨ä¾‹æ•°ï¼š139ä¸ª
â”œâ”€â”€ å•å…ƒæµ‹è¯•ï¼š127ä¸ª (91.4%)
â””â”€â”€ é›†æˆæµ‹è¯•ï¼š12ä¸ª (8.6%)

è¦†ç›–çš„æ¨¡å—ï¼š
â”œâ”€â”€ é…ç½®ç®¡ç†æ¨¡å—ï¼š33ä¸ªæµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ æ•°æ®ç®¡ç†æ¨¡å—ï¼š24ä¸ªæµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ éªŒè¯ç è¯†åˆ«æ¨¡å—ï¼š18ä¸ªæµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ WebDriverç®¡ç†æ¨¡å—ï¼š21ä¸ªæµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ åº”ç”¨ç¨‹åºä¸»é€»è¾‘ï¼š16ä¸ªæµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ æ€§èƒ½ç›‘æ§æ¨¡å—ï¼š15ä¸ªæµ‹è¯•ç”¨ä¾‹
â””â”€â”€ é›†æˆæµ‹è¯•ï¼š12ä¸ªæµ‹è¯•ç”¨ä¾‹
```

## ğŸ› ï¸ æµ‹è¯•æŠ€æœ¯ç‰¹ç‚¹

### 1. å…¨é¢çš„Mockä½¿ç”¨
- ä½¿ç”¨`unittest.mock`é¿å…å¤–éƒ¨ä¾èµ–
- æ¨¡æ‹Ÿæ–‡ä»¶I/Oã€ç½‘ç»œè¯·æ±‚ã€ç¬¬ä¸‰æ–¹åº“
- ç¡®ä¿æµ‹è¯•çš„ç‹¬ç«‹æ€§å’Œå¯é‡å¤æ€§

### 2. å‚æ•°åŒ–æµ‹è¯•
- è¦†ç›–å¤šç§é…ç½®ç»„åˆ
- æµ‹è¯•è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸åœºæ™¯
- éªŒè¯ä¸åŒå‚æ•°ä¸‹çš„è¡Œä¸º

### 3. é”™è¯¯åœºæ™¯è¦†ç›–
- æ–‡ä»¶ä¸å­˜åœ¨/æ— æ³•è®¿é—®
- ç½‘ç»œè¿æ¥å¤±è´¥
- é…ç½®é”™è¯¯å’Œæ ¼å¼é—®é¢˜
- æƒé™ä¸è¶³å’Œç³»ç»Ÿé”™è¯¯

### 4. æ€§èƒ½æµ‹è¯•
- ç›‘æ§æ“ä½œæ‰§è¡Œæ—¶é—´
- éªŒè¯æ…¢æ“ä½œæ£€æµ‹æœºåˆ¶
- æµ‹è¯•å†…å­˜ä½¿ç”¨å’Œèµ„æºæ¸…ç†

### 5. é›†æˆéªŒè¯
- ç»„ä»¶é—´æ¥å£æµ‹è¯•
- ç«¯åˆ°ç«¯å·¥ä½œæµç¨‹æµ‹è¯•
- æ•°æ®æµå’ŒçŠ¶æ€ä¸€è‡´æ€§éªŒè¯

## ğŸš€ è¿è¡Œæµ‹è¯•

### å‰ç½®è¦æ±‚
```bash
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-cov

# é¡¹ç›®ä¾èµ–ï¼ˆå·²é€šè¿‡uvå®‰è£…ï¼‰
uv pip install -e .
```

### è¿è¡Œæµ‹è¯•å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/ -v --cov=src/ruijie_query --cov-report=term-missing

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
pytest tests/unit/test_config_manager.py -v
pytest tests/integration/test_full_workflow.py -v

# ç”ŸæˆHTMLè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=src/ruijie_query --cov-report=html
```

### é¢„æœŸè¦†ç›–ç‡
åŸºäºæµ‹è¯•ç”¨ä¾‹è®¾è®¡ï¼Œé¢„æœŸä»£ç è¦†ç›–ç‡ï¼š
- **é…ç½®ç®¡ç†æ¨¡å—ï¼š** >95%
- **æ•°æ®ç®¡ç†æ¨¡å—ï¼š** >90%
- **éªŒè¯ç è¯†åˆ«æ¨¡å—ï¼š** >85%
- **WebDriverç®¡ç†æ¨¡å—ï¼š** >80%
- **åº”ç”¨ç¨‹åºä¸»é€»è¾‘ï¼š** >90%
- **æ€§èƒ½ç›‘æ§æ¨¡å—ï¼š** >95%

## âš ï¸ å½“å‰çŠ¶æ€è¯´æ˜

### âœ… å·²å®Œæˆ
- [x] æ‰€æœ‰æµ‹è¯•æ–‡ä»¶åˆ›å»ºå®Œæˆ
- [x] æµ‹è¯•é€»è¾‘è®¾è®¡å®Œæ•´
- [x] Mockå¯¹è±¡é…ç½®æ­£ç¡®
- [x] æµ‹è¯•ç»“æ„ç¬¦åˆæœ€ä½³å®è·µ
- [x] æ–‡æ¡£å’Œè¯´æ˜å®Œå–„

### âš ï¸ éœ€è¦æ³¨æ„
- **ç¯å¢ƒä¾èµ–é—®é¢˜ï¼š** numpy/pandasç‰ˆæœ¬å…¼å®¹æ€§éœ€è¦è§£å†³
- **å®é™…è¿è¡Œï¼š** éœ€è¦åœ¨è§£å†³ä¾èµ–åæ‰§è¡Œå®é™…æµ‹è¯•
- **è¦†ç›–ç‡æŠ¥å‘Šï¼š** å®é™…è¦†ç›–ç‡æ•°æ®éœ€è¦æµ‹è¯•è¿è¡Œåç”Ÿæˆ

## ğŸ”§ è§£å†³ä¾èµ–é—®é¢˜çš„æ–¹æ³•

### æ–¹æ³•1ï¼šå‡çº§numpy
```bash
pip install --upgrade numpy
pip install --upgrade pandas
```

### æ–¹æ³•2ï¼šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
```bash
python -m venv test_env
source test_env/bin/activate  # Linux/Mac
# test_env\Scripts\activate   # Windows
pip install -e .
pip install pytest pytest-cov
```

### æ–¹æ³•3ï¼šä½¿ç”¨Docker
```bash
docker run --rm -v $(pwd):/app -w /app python:3.10 bash -c "
pip install -e . &&
pip install pytest pytest-cov &&
python -m pytest tests/ -v --cov=src/ruijie_query --cov-report=term-missing
"
```

## ğŸ’¡ æµ‹è¯•æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åè§„èŒƒ
- æµ‹è¯•æ–‡ä»¶ï¼š`test_<module_name>.py`
- æµ‹è¯•ç±»ï¼š`Test<ClassName>`
- æµ‹è¯•æ–¹æ³•ï¼š`test_<functionality>_<scenario>`

### 2. æµ‹è¯•ç»„ç»‡ç»“æ„
```
tests/
â”œâ”€â”€ unit/           # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_config_manager.py
â”‚   â”œâ”€â”€ test_data_manager.py
â”‚   â”œâ”€â”€ test_captcha_solver.py
â”‚   â”œâ”€â”€ test_webdriver_manager.py
â”‚   â”œâ”€â”€ test_app.py
â”‚   â””â”€â”€ test_performance_monitor.py
â”œâ”€â”€ integration/    # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ test_full_workflow.py
â””â”€â”€ conftest.py     # pytesté…ç½®
```

### 3. Mockç­–ç•¥
- **å¤–éƒ¨ä¾èµ–ï¼š** ä½¿ç”¨Mocké¿å…ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ç³»ç»Ÿè®¿é—®
- **ç¬¬ä¸‰æ–¹åº“ï¼š** Mock Seleniumã€ddddocrç­‰åº“çš„è¡Œä¸º
- **å¤æ‚ç»„ä»¶ï¼š** åˆ†å±‚Mockï¼Œä¿æŒæµ‹è¯•çš„èšç„¦æ€§

### 4. æµ‹è¯•æ•°æ®ç®¡ç†
- **ä¸´æ—¶æ–‡ä»¶ï¼š** ä½¿ç”¨`tempfile`æ¨¡å—åˆ›å»ºå’Œæ¸…ç†
- **æµ‹è¯•é…ç½®ï¼š** å†…è”é…ç½®å­—ç¬¦ä¸²ï¼Œé¿å…å¤–éƒ¨æ–‡ä»¶ä¾èµ–
- **è¾¹ç•Œæ•°æ®ï¼š** åŒ…å«æ­£å¸¸ã€å¼‚å¸¸ã€è¾¹ç•Œå€¼æµ‹è¯•

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æµ‹è¯•å•å…ƒè¦†ç›–ç‡è¡¥å…¨å·¥ä½œæˆåŠŸä¸ºé”æ·ç½‘ç»œè®¾å¤‡ä¿ä¿®æœŸæ‰¹é‡æŸ¥è¯¢å·¥å…·é¡¹ç›®å»ºç«‹äº†å®Œæ•´çš„æµ‹è¯•ä½“ç³»ï¼š

1. **è¦†ç›–ç‡å…¨é¢ï¼š** è¦†ç›–äº†æ‰€æœ‰6ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå…±139ä¸ªæµ‹è¯•ç”¨ä¾‹
2. **è´¨é‡ä¿è¯ï¼š** åŒ…å«å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ç­‰å¤šç§ç±»å‹
3. **å¯ç»´æŠ¤æ€§ï¼š** ä½¿ç”¨æ ‡å‡†æµ‹è¯•æ¡†æ¶å’Œæœ€ä½³å®è·µï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•
4. **å®ç”¨æ€§ï¼š** æµ‹è¯•åœºæ™¯è´´è¿‘å®é™…ä½¿ç”¨æƒ…å†µï¼Œèƒ½å¤Ÿæœ‰æ•ˆå‘ç°æ½œåœ¨é—®é¢˜

ä¸€æ—¦è§£å†³numpy/pandasä¾èµ–é—®é¢˜å¹¶æˆåŠŸè¿è¡Œæµ‹è¯•ï¼Œè¯¥é¡¹ç›®å°†æ‹¥æœ‰ä¸šç•Œæ ‡å‡†çš„æµ‹è¯•è¦†ç›–ç‡å’Œè´¨é‡ä¿è¯ä½“ç³»ã€‚